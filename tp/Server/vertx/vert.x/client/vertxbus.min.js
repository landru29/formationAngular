var vertx=vertx||{};
!function(k){"function"===typeof define&&define.amd?define("vertxbus",["sockjs"],k):k(SockJS)}(function(k){vertx.EventBus=function(o,p){function m(b,a,c,e){h("address","string",a);h("replyHandler","function",e,!0);l();b={type:b,address:a,body:c};d.sessionID&&(b.sessionID=d.sessionID);e&&(a=q(),b.replyAddress=a,n[a]=e);e=JSON.stringify(b);g.send(e)}function l(){if(i!=vertx.EventBus.OPEN)throw Error("INVALID_STATE_ERR");}function h(b,a,c,e){if(!e&&!c)throw Error("Parameter "+b+" must be specified");if(c&&
typeof c!=a)throw Error("Parameter "+b+" must be of type "+a);}function q(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b,a){return a=16*Math.random(),("y"==b?a&3|8:a|0).toString(16)})}var d=this,g=new k(o,void 0,p),j={},n={},i=vertx.EventBus.CONNECTING;d.onopen=null;d.onclose=null;d.login=function(b,a,c){m("send","vertx.basicauthmanager.login",{username:b,password:a},function(a){"ok"===a.status&&(d.sessionID=a.sessionID);c&&(delete a.sessionID,c(a))})};d.send=function(b,
a,c){m("send",b,a,c)};d.publish=function(b,a,c){m("publish",b,a,c)};d.registerHandler=function(b,a){h("address","string",b);h("handler","function",a);l();var c=j[b];c?c[c.length]=a:(c=[a],j[b]=c,g.send(JSON.stringify({type:"register",address:b})))};d.unregisterHandler=function(b,a){h("address","string",b);h("handler","function",a);l();var c=j[b];if(c){var d=c.indexOf(a);-1!=d&&c.splice(d,1);0==c.length&&(g.send(JSON.stringify({type:"unregister",address:b})),delete j[b])}};d.close=function(){l();i=
vertx.EventBus.CLOSING;g.close()};d.readyState=function(){return i};g.onopen=function(){i=vertx.EventBus.OPEN;if(d.onopen)d.onopen()};g.onclose=function(){i=vertx.EventBus.CLOSED;if(d.onclose)d.onclose()};g.onmessage=function(b){var a=JSON.parse(b.data),b=a.body,c=a.replyAddress,a=a.address,e;c&&(e=function(a,b){d.send(c,a,b)});var f=j[a];if(f){a=f.slice(0);for(f=0;f<a.length;f++)a[f](b,e)}else if(f=n[a])delete n[a],f(b,e)}};vertx.EventBus.CONNECTING=0;vertx.EventBus.OPEN=1;vertx.EventBus.CLOSING=
2;vertx.EventBus.CLOSED=3;return vertx.EventBus});